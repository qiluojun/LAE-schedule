# LAE - 个人日程与主支线管理系统 v1 

**版本: 1.0 **

## 1\. 项目背景 (Project Background)

为了解决在多任务并行时，对未来时间安排的高度不确定性和焦虑感，本项目旨在开发一个供个人使用的日程/主支线任务管理系统。通过**量化与可视化**的手段，清晰、直观地掌控个人时间和精力。

`zeroPPD` 将作为本系统设计和实践的第一个核心应用场景。

## 2\. 核心功能 (Core Features)

  * **主支线任务管理:** 支持无限层级的父子任务结构。
  * **时间块估算与生成:** 以固定的“时段”为单位来规划任务。
  * **可视化排程白板:** 在周视图中通过拖拽方式安排日程。
  * **多视图切换:** 支持月视图、周视图和汇总视图。
  * **目标与进度管理:** 为每一次具体的日程安排附加一个可追踪的 `goal`。
  * **数据汇总与统计:** 在汇总视图中查看各主支线的精力投入和目标列表。

## 3\. 系统架构与技术栈 (System Architecture & Technical Stack)

本项目将采用**方案A：轻量级Web框架**模式进行开发，在本地运行，通过浏览器访问。

  * **后端 (Backend):**

      * **语言:** Python
      * **Web 框架:** Flask (或 FastAPI)
      * **职责:** 负责所有业务逻辑、数据处理，并通过 API 接口与前端交互。

  * **数据库 (Database):**

      * **类型:** SQLite (单个 `.db` 文件，易于管理)
      * **交互:** 采用 **SQLAlchemy** (ORM) 进行数据库操作，以获得更好的代码可读性和维护性。

  * **前端 (Frontend):**

      * **技术:** HTML, CSS, JavaScript
      * **职责:** 负责渲染用户界面 (UI)，处理用户交互（如点击、拖拽），并通过异步请求(Ajax/Fetch)调用后端 API。

## 4\. 数据模型 (Data Model)

系统的核心由两张 SQL 数据表构成，通过 SQLAlchemy 的 Models 进行定义。

#### 4.1. `activities` (活动库)

定义所有可供选择的活动卡片及其层级关系。

| 字段名 (Field) | 类型 (Type) | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 唯一主键 |
| `name` | TEXT | 活动名称 (如 "zeroPPD-读文献") |
| `parent_id` | INTEGER | 指向父级活动的 `id`，顶级活动为 `NULL` |
| `description` | TEXT | (可选) 对活动的详细描述 |
| `created_at` | DATETIME | 创建时间 |

#### 4.2. `scheduled_events` (已安排日程)

记录每一次具体的日程安排。

| 字段名 (Field) | 类型 (Type) | 描述 |
| :--- | :--- | :--- |
| `id` | INTEGER | 唯一主键 |
| `activity_id` | INTEGER | 外键，关联到 `activities.id` |
| `event_date` | DATE | 日程发生的日期 |
| `time_slot` | INTEGER | 时间槽编号 (详见时间槽规则) |
| `goal` | TEXT | 本次活动要达成的具体目标 (如 "读完第三篇文献") |
| `notes` | TEXT | 备注信息，不参与统计分析 |
| `status` | TEXT | 活动状态 (如: 'planned', 'completed') |

#### 4.3. 时间槽编码规则

采用两位数编码：**第一位代表时段，第二位代表该时段内的序号**

**当前实现的时间槽：**
- `21`: 上午第1时段
- `22`: 上午第2时段  
- `51`: 下午第1时段
- `52`: 下午第2时段
- `71`: 晚上时段

**扩展示例（未来可能添加）：**
- `81`, `82`: 睡前时段
- `11`, `12`, `13`: 早晨时段
- 等等

这种编码方式便于未来扩展更多时段，而不影响现有数据。

## 5\. 核心机制与视图逻辑 (Core Mechanisms & View Logic)

#### 5.1. 月视图 (Month View)

  * **功能:** 宏观展示整月日程负荷，并作为导航入口。
  * **逻辑:** 后端查询指定月份的 `scheduled_events`，按天聚合活动数量。前端渲染日历网格，在每日单元格内显示活动数量的缩略信息。点击某一周可跳转至对应的周视图。

#### 5.2. 周视图 (Week View)

  * **功能:** 项目的核心交互界面，用于日程的拖拽式编排。
  * **布局:**
      * **左侧 (或右侧):** “活动卡片池”。后端查询 `activities` 表并构建层级树，前端将其渲染为可拖拽的卡片列表。
      * **主区域:** 7天 x 5个时间槽的网格。
  * **交互逻辑:**
    1.  用户从“活动卡片池”中拖拽一个活动卡片。
    2.  将其放置 (drop) 到主区域的某个具体时间槽中。
    3.  此时，前端可弹出一个输入框，让用户填写本次的 `goal`。
    4.  信息收集完毕后，前端 JavaScript 向后端 API 发送一个 `POST` 请求，请求体包含 `{activity_id, event_date, time_slot, goal}`。
    5.  后端接收请求，在 `scheduled_events` 表中创建一条新记录。
    6.  成功后，前端将该活动卡片正式渲染在目标时间槽中。

#### 5.3. 汇总视图 (Summary View) - 层级化活动管理中心

  * **功能:** 所有活动（主支线）的管理中心和层级化统计仪表盘。
  * **核心特性:**
    1.  **层级化活动管理:** 支持多级活动结构（如 `zeroPPD` → `zeroPPD-读文献` → `读新加的文献`）
    2.  **完整 CRUD 功能:** 创建、修改、删除任意层级的活动
    3.  **聚合统计显示:** 父级活动统计包含所有子活动的数据
    4.  **Goal 追踪管理:** 显示每个活动的所有目标及完成状态
  
  * **详细逻辑:**
    1.  **活动层级展示:**
        - 按层级顺序显示，父级活动在上，子级活动缩进显示
        - 父级活动统计信息聚合所有子活动数据
        - 子级活动独立显示自己的统计信息
    
    2.  **统计信息展示:**
        - **安排次数统计:** 显示某月该活动被安排的总次数
        - **完成率统计:** 基于 goal 的完成状态计算
        - **Goal 列表:** 显示该活动的所有已安排目标及其日期
    
    3.  **Goal 管理系统:**
        - 当用户在周视图中拖拽活动到时间槽时，可添加具体目标
        - 示例：`zeroPPD-读文献` 安排在 "九月第四周周三上午第二时段"，目标："读完第三篇文献"
        - 汇总视图中显示：活动 `zeroPPD-读文献` 包含目标 "读完第三篇文献 (9月第4周周三)"
    
    4.  **活动卡片来源:**
        - 周视图中的拖拽卡片池来源于汇总视图创建的活动
        - 支持拖拽任意层级的活动（父级或子级）到时间槽

## 6\. 层级化活动架构 (Hierarchical Activity Architecture)

  * **设计理念:** LAE 系统采用递归的层级化活动管理，支持无限深度的活动嵌套。
  
  * **典型使用场景:**
    ```
    zeroPPD (顶级项目)
    ├── zeroPPD-读文献 (子活动)
    │   ├── 读新加的文献 (三级活动)
    │   └── 文献综述整理 (三级活动)
    ├── zeroPPD-分析数据 (子活动)
    │   ├── 数据清洗 (三级活动)
    │   └── 统计分析 (三级活动)
    └── zeroPPD-写论文 (子活动)
    ```
  
  * **核心功能特性:**
    1. **灵活拖拽:** 可将任意层级的活动拖拽到时间槽
    2. **聚合统计:** 父级活动自动聚合所有子活动的统计数据
    3. **Goal 管理:** 每个具体安排都有独立的目标和完成状态
    4. **月度追踪:** 按月统计每个活动的安排频次和目标完成情况

## 7\. Obsidian & Markdown 集成 (Obsidian & Markdown Integration)

  * **功能:** 提供"导出为 Markdown"功能，将日程安排无缝集成到现有的知识管理工作流中。
  * **实现:** 在 Python 后端创建一个 API 端点，用于生成指定时间范围（天/周）的 Markdown 格式日程。
  * **输出示例 (`YYYY-WW.md`):**
    ```markdown
    # 2025年第39周 日程总结

    ## 2025-09-22 (周一)
    - **上午1:** [ ] **zeroPPD-分析数据**: 完成初步数据清洗。
    - **上午2:** [ ] *未安排*
    ...

    ## 2025-09-23 (周二)
    - **上午1:** [ ] **zeroPPD-读文献**: 读完第三篇文献。
    ...
    ```

## 7\. 开发路线图 (Development Roadmap)

### 已完成阶段

1.  **✅ Phase 1: 后端与数据基础** *(已完成)*

      * ✅ 初始化 FastAPI 项目结构
      * ✅ 使用 SQLAlchemy 定义 `Activity` 和 `ScheduledEvent` 数据模型并创建数据库
      * ✅ 编写核心的后端 API 端点：
          * ✅ 对 `activities` 的完整 CRUD
          * ✅ 对 `scheduled_events` 的完整 CRUD  
          * ✅ 获取周/月日程的 API
          * ✅ 获取汇总统计的 API
      * ✅ 增加 `notes` 字段支持备注功能

2.  **✅ Phase 2: 核心 UI 开发** *(已完成)*

      * ✅ 搭建基础的 HTML 页面框架 (Bootstrap + Alpine.js + SortableJS)
      * ✅ 开发 **汇总视图**，实现活动管理和树形结构显示
      * ✅ 开发 **周视图**，实现 7×N 动态网格布局
      * ✅ 集成 JavaScript 拖拽库并解决所有交互问题
      * ✅ 完善拖拽功能和用户交互

3.  **✅ Phase 3: 功能增强** *(已完成)*

      * ✅ 完善拖拽功能和用户交互
      * ✅ 开发完整的 **月视图** 及其导航功能
      * ✅ 完善汇总视图的统计逻辑和数据展示
      * ✅ 优化用户体验和界面响应
      * ✅ 实现汇总视图活动编辑功能（名称、描述）
      * ✅ 实现月视图日程概览显示

4.  **✅ Phase 4: 调试与最后优化** *(已完成)*
      * ✅ 新功能：允许已在网格中的活动卡片被拖拽到其他空格子中
      * ✅ 新功能：将网格中的事件拖回活动池进行删除
      * ✅ 优化体验：修复卡池卡片拖拽后消失的问题
      * ✅ 优化体验：修复拖拽动画卡顿和重复初始化问题
      * ✅ 智能拖拽验证：自动检测和修复无效拖拽目标
      * ✅ 网格尺寸优化：增大间距和尺寸提高拖拽精度

### 🎉 V1.0 开发完成 (2025-09-13)

**系统特性**：
- ✅ 层级化活动管理（无限嵌套支持）
- ✅ 直观的拖拽式日程安排
- ✅ 智能的拖拽位置判断和错误修复
- ✅ 三视图切换（汇总/周视图/月视图）
- ✅ 完整的CRUD操作和统计功能

**技术架构**：
- ✅ FastAPI + SQLAlchemy + SQLite 后端架构
- ✅ Bootstrap + Alpine.js + SortableJS 前端架构
- ✅ 响应式设计和跨浏览器兼容
- ✅ 完整的错误处理和用户反馈机制

**🟢 系统已可投入使用**，所有核心功能验证通过。

### 🚀 后续发展方向 (V2.0+)

**功能扩展**：
- Markdown导出功能（与Obsidian集成）
- 移动端适配和响应式优化
- 数据备份和恢复功能
- 更多时间槽类型支持

**性能优化**：
- 前端缓存机制
- 数据库查询优化
- 大数据量处理支持

**用户体验**：
- 界面主题定制
- 键盘快捷键支持
- 批量操作功能


## 8\. 技术栈详情

**后端技术栈:**
- **框架:** FastAPI 0.104.1
- **数据库:** SQLite + SQLAlchemy 2.0.23 ORM
- **服务器:** Uvicorn (开发环境)

**前端技术栈:**
- **基础:** HTML5 + CSS3 + JavaScript (ES6+)
- **UI框架:** Bootstrap 5.3.0
- **状态管理:** Alpine.js 3.13.0
- **拖拽功能:** SortableJS 1.15.0

**开发工具:**
- **依赖管理:** pip + requirements.txt  
- **开发服务器:** 热重载支持
- **API文档:** 自动生成 (FastAPI Swagger)

# LAE - 个人日程与主支线管理系统 v2 

## 待整理的方向/功能 设想

开发 **Markdown 导出** 功能

DDL 
欸嘿 那这种怎么应对小的零碎时间？一些零碎的活动？以及爆破时间？以及一些高度飘忽不定的事情？  
		我母鸡啊！日后完全自动化了 当然可以实现自动化的记录 但是目前可能还做不到 啊啊啊啊啊啊啊 *未来再说*
		以及 一天的block 更细更灵活的划分 后续再说~ 
以及 统计的信息 除了次数 也要考虑时间长度 还要考虑活动属性
  越来越复杂了 2333 


# 开发注意事项（AI无需阅读此板块）


## 元认知 
LAE schedule 方面
	汇总界面的更新 是比较小、好办的更新 只要描述清楚机制就行
	有一些变化和新增 涉及的机制比较复杂 可以让claude对目前整体框架进行描述 然后我单独问GEMINI 从而获得元信息 哪些变化比较易得等等